# 📋 Nexus Ark タスクリスト

**最終更新**: 2026-01-17

- [x] **Arousal-Aware Time Decay & Intent-Aware Retrieval** ✅ (2026-01-16 完了)
  - Phase 1-3: Intent分類器、時間減衰計算、3項式スコアリング実装完了
  - Phase 5: Intent分類のAPIコスト最適化（retrieval_nodeに統合）
  - 関連: [arousal_aware_time_decay_study.md](research/arousal_aware_time_decay_study.md) | [レポート1](../reports/2026-01-16_intent_aware_retrieval.md) | [レポート2](../reports/2026-01-16_intent_classification_optimization.md)

- [x] **Arousalアノテーション付き日次要約** ✅ (2026-01-17 完了)
  - 日次要約に各会話のArousalをアノテーション
  - 高Arousal（≥0.6）会話を★マークで詳細化、低Arousalは簡潔に
  - 週次圧縮プロンプトをペルソナ視点+文字数制限に変更
  - セッション単位の課題（コスト・口調不安定）を解決
  - [レポート](../reports/2026-01-17_episodic_summary_arousal_annotation.md)

- [x] **セッション単位エピソード記憶 (Arousal連動)** ⚠️ (2026-01-15 → 2026-01-17 日次に回帰)
  - 日単位からセッション単位へのエピソード記憶生成を試行
  - 課題発覚: APIコスト増大、短い会話で口調不安定
  - **2026-01-17**: Arousalアノテーション付き日次要約へ回帰
  - 関連: [episodic_memory_memrl_study.md](research/episodic_memory_memrl_study.md)
  - [レポート](../reports/2026-01-15_session_based_episodic_memory.md)

- [x] **Phase H: Arousal Phase 3 - 記憶共鳴フィードバック機構** ✅ (2026-01-15 完了)
  - 記憶の重要度（Arousal）を共鳴度フィードバックで自己更新
  - エピソード記憶へのID自動付与
  - 関連: [episodic_memory_memrl_study.md](research/episodic_memory_memrl_study.md)
  - [レポート](../reports/2026-01-15_phase_h_arousal_self_evolution.md)

- [x] **Phase F: 関係性維持欲求の実装** ✅ (2026-01-15 完了)
  - ペルソナ感情出力（`<persona_emotion>`）を追加
  - ユーザー感情分析を廃止（APIコスト削減）
  - 絆確認エピソード記憶の生成
  - 関連: [motivation_system_improvement.md](motivation_system_improvement.md)
  - [レポート](../reports/2026-01-15_phase_f_relatedness_drive.md)

- [x] **Phase E: 自己実現欲求の還元** ✅ (2026-01-14 完了)
  - 目標達成時に高Arousalエピソード記憶を自動生成
  - 達成体験を「輝く星」としてRAG検索で想起可能に
  - 関連: [motivation_system_improvement.md](motivation_system_improvement.md)
  - [レポート](../reports/2026-01-14_phase_e_achievement_memory.md)

- [x] **Phase G: 知識欲求の拡張** ✅ (2026-01-14 完了)
  - Phase Bを拡張し、発見時にエピソード記憶も生成
  - 知識獲得が「発見の喜び」として記憶に刻まれる
  - 関連: [motivation_system_improvement.md](motivation_system_improvement.md)
  - [レポート](../reports/2026-01-14_phase_g_discovery_memory.md)

- [x] **チェス機能の統合** 🆕 ✅ (2026-01-12 完了)
  - `chessboardjs`による対話型チェス盤（チャットタブ内にアコーディオン）
  - ペルソナが盤面認識・操作可能
  - ルームごとの状態永続化
  - [レポート](file:///home/baken/nexus_ark/docs/reports/2026-01-12_chess_integration.md)

---

## 🔴 優先度: クリティカル（リリースブロッカー）

これらが解決しないとリリースできない

### バグ修正・システム安定化

- [x] **エピソード記憶の分量調整（予算緩和）** 🆕
  - ✅ 完了 (2026-01-17)
  - 調整内容: Arousalベースの文字数予算を従来の約2倍に緩和（High: 600, Medium: 350, Low: 150文字）。日次要約の行数増強を含むプロンプト改善と定数化。
  - [レポート](../reports/2026-01-17_episodic_memory_budget_relaxing.md)

- [x] **エピソード記憶システムの問題修正** 🆕
  - ✅ 完了 (2026-01-17)
  - 修正内容: 絆確認機能の廃止、旧形式データ移行問題、特殊タイプ重複判定、UIでの表示不整合（複数表示・ソート・重複排除）を修正
  - [レポート](../reports/2026-01-16_episodic_memory_fixes.md)

- [x] **Arousal正規化プロセスの実装** 🆕 (外部AI助言)
  - ✅ 完了 (2026-01-17): 睡眠時省察（週次/月次）でのArousalインフレ防止
  - レポート: [2026-01-17_arousal_normalization.md](../reports/2026-01-17_arousal_normalization.md)

- [x] **ファイル競合対策（Race Condition防止）** 🆕 (外部AI助言)
  - ✅ 完了 (2026-01-17): filelock導入による主要Managerの保護
  - レポート: [2026-01-17_file_lock_race_condition_fix.md](../reports/2026-01-17_file_lock_race_condition_fix.md)

- [x] **「安全装置 (`_ensure_output_count`)」の全域適用**
  - ✅ 完了 (2026-01-10)
  - `handle_delete_room` での引数渡し漏れを修正し、主要ハンドラの保護を確認

  - `tools/validate_wiring.py` を作成し、主要ハンドラの不整合（159/157問題など）を検出し修正

- [x] **ドキュメントのパス修正**
  - ✅ 完了 (2026-01-10)
  - `tools/fix_windows_paths.py` を作成し、絶対パスを一括で相対パスに置換

- [x] **チャットのRAWログエディタ、保存時に末尾へ改行を自動付加** 🆕
  - ✅ 完了 (2026-01-11)
  - 保存後、末尾に改行がないために次回の発言が前回の吹き出しに融合する問題を修正
  - [レポート](file:///home/baken/nexus_ark/docs/reports/2026-01-11_raw_log_editor_newline_fix.md)

- [x] **サイドバーのスクロール修正とUI復旧** 🆕
  - ✅ 完了 (2026-01-11)
  - サイドバーがコンテンツ量に応じてスクロール可能になるよう修正。構造デグレードも復旧済み。
  - [レポート](file:///home/baken/nexus_ark/docs/reports/2026-01-11_fix_sidebar_scrolling.md)







- [x] **Web巡回ツールのTavily Extractエラー修正**
  - ✅ 完了 (2026-01-09)
  - 修正内容: `TavilyExtract`初期化時の引数名ミス(`api_key`->`tavily_api_key`)を修正
  - レポート: [2026-01-09_tavily_extract_fix.md](file:///home/baken/nexus_ark/docs/reports/2026-01-09_tavily_extract_fix.md)

- [x] **スマホ等縦長画面で右カラムがスクロールできず下部のメニューが操作できないときがある**
  - ✅ 完了 (2025-12-29)
  - 修正内容: CSS調整によるメインエリアのスクロール確保とメディアクエリ対応

- [x] **縦長画面時に左右カラムのつまみが重なり操作不能になる問題**
  - ✅ 完了 (2025-12-30)
  - 修正内容: モバイル表示時に左サイドバーのつまみを60px下にオフセットし、左右のつまみが重ならないよう調整

- [x] **Nexus Ark アコーディオンのスクロールバー不具合**
  - ✅ 完了 (2025-12-27)
  - レポート: [2025-12-27_accordion_scrollbar_fix.md](../reports/2025-12-27_accordion_scrollbar_fix.md)

- [x] **マルチモーダル添付の修正**
  - ✅ 複数画像添付: `file_count="multiple"` 追加
  - ✅ MP3音声認識: `{"type": "file", ...}` 形式で送信
  - ✅ AI応答二重表示: チャンク処理修正
  - ⚠️ MP4動画: API制限のため未対応（将来の課題）
  - レポート: [2025-12-20_multimodal_fix_report.md](../reports/2025-12-20_multimodal_fix_report.md)

- [x] **自律行動の重複発火バグ**
  - ハイブリッド方式（タイムスタンプ＋メモリ内フラグ）で修正
  - レポート: [2025-12-21_autonomous_action_duplicate_fix.md](../reports/2025-12-21_autonomous_action_duplicate_fix.md)

- [x] **タイムスタンプ二重付記バグ**
  - AIが日本語曜日形式でタイムスタンプを生成する問題を修正
  - 正規表現を日本語/英語両対応に拡張
  - レポート: [2025-12-21_timestamp_duplicate_fix.md](../reports/2025-12-21_timestamp_duplicate_fix.md)

- [x] **モデル名付記バグ**
  - 個別設定でモデル変更後、古いモデル名がタイムスタンプに付記される問題を修正
  - さらにAI模倣タイムスタンプ問題（AIが過去の応答のタイムスタンプを模倣）を根本修正
  - レポート: [2025-12-22_ai_timestamp_mimicry_fix.md](../reports/2025-12-22_ai_timestamp_mimicry_fix.md)

### 安定性

- [x] **使用モデルリストの精査** ✅
  - 動作確認済みモデルのみに絞る
  - Gemini 3 Flash Previewは応答遅延問題あり（[gradio_notes.md](../guides/gradio_notes.md) レッスン33）
  - おすすめモデルだけのリストを作成
  - レポート: [2025-12-26_model_list_management.md](../reports/2025-12-26_model_list_management.md)

- [x] **モデルリストのUI管理機能強化** ✅
  - UI上からモデルの削除を可能にする
  - デフォルトモデルリストで上書きして初期状態に戻す機能
  - APIからモデルリスト取得機能追加（Groq/Ollama/OpenRouter対応）
  - お気に入りモデル機能（⭐マークでトグル）
  - ドロップダウン未表示バグ修正（visible=Falseグループ内のレンダリング問題）
  - レポート: [2025-12-27_model_list_management.md](../reports/2025-12-27_model_list_management.md)

- [/] **Gemini 3シリーズの空応答・思考タグ問題**
  - 空応答が頻発（思考レベル変更で解消せず）
  - ツール使用のみ成功して応答テキストが空になるケースあり
  - `[THOUGHT]`タグを開始するが閉じタグがなく全文が思考ログ化
  - ℹ️ **2025-12-23 調査結果**: API不安定性が原因。対処法は [gemini3_flash_setup.md](../guides/gemini3_flash_setup.md) 参照
  - レポート: [2025-12-21_gemini3_debug_log_addition.md](../reports/2025-12-21_gemini3_debug_log_addition.md)

- [x] **新規ルーム作成時、自動情景画像生成をオフにする** ✅
  - `enable_scenery_system` を `False` に変更（情景システム無効化により画像生成も発生しない）

- [x] **APIコンテキスト設定の初期値変更** ✅
  - 送信履歴: 20件
  - エピソード記憶: 無効（0日）
  - 記憶の想起: 無効
  - 思考過程をAPIに送信: オフ
  - AI生成パラメータの温度: 1.0

- [x] **モデルリストの「(Slow Response)」除去** ✅
  - デフォルトモデルリストから注釈を削除済み

- [x] 研究・分析ノートの全文がシステムプロンプトに注入されている問題の改善 <!-- id: 104 -->
    - [レポート](docs/reports/2026-01-10_optimize_research_notes.md)

- [x] 創作ノートの全文がシステムプロンプトに注入されている問題の改善 <!-- id: 105 -->

- [x] **創作ノート改善** 🆕
  - ✅ 完了 (2026-01-10): 研究ノート・創作ノートでセッション単位で1回のみタイムスタンプを付与するよう修正
  - レポート: [2026-01-10_notes_timestamp_per_session.md](../reports/2026-01-10_notes_timestamp_per_session.md)

- [x] **Gradio警告「Unexpected argument. Filling with None.」と配線修正** 🆕
  - ✅ 完了 (2026-01-11): 警告抑制と5件の配線エラー修正
  - [レポート](file:///home/baken/nexus_ark/docs/reports/2026-01-11_fix_gradio_wiring_and_warnings.md)

- [x] **Arousal正規化プロセスの実装** 🆕 (外部AI助言) ✅ (2026-01-17 完了)
  - 長期運用でArousalインフレが発生するリスク対策
  - 睡眠時処理に全体平均が高い場合の減衰（×0.9）を追加
  - 実装: `EpisodicMemoryManager.normalize_arousal()` 、週次省察時に自動実行
  - [レポート](../reports/2026-01-17_arousal_normalization.md)

- [x] **ファイル競合対策（Race Condition防止）** 🆕 (外部AI助言) ✅ (2026-01-17 完了)
  - 睡眠時処理中にユーザーが話しかけた場合の排他制御
  - `episodic_memory.json`等への同時書き込みによる破損リスク対策
  - [レポート](../reports/2026-01-17_file_lock_race_condition_fix.md)

- [ ] **英語対応** 🆕
  - メニューの日本語表示と英語表示を切り替えられるようにする。 (INBOXより)

- [x] **トークン数カウントの見直し** 🆕 ✅ 完了 (2026-01-11)
  - エピソード記憶期間のパースロジック修正と実送信トークン数表示のキー名修正
  - レポート: [2026-01-11_token_display_fix.md](../reports/2026-01-11_token_display_fix.md)

- [ ] **GeminiAPIキーのローリング？機能** 🆕
  - 無料APIキーで一日の上限等のエラー出たら次のキーを使う…を繰り返し最後に有料キーを使う。 (INBOXより)

- [ ] **創作ノートのRAG化** 🆕
  - 秘密の日記もRAG化する？　でもユーザーに読めない外国語多用なので検索できる？ (INBOXより)

- [x] **🧠 内的状態 (Internal State)のブラッシュアップ** 🆕 [レポート](../reports/2026-01-13_internal_state_improvement.md)
  - 「❓ 未解決の問い（好奇心の源泉）」が、会話で解決しているように見えてもずっと「未回答」でどんどん問いが増える一方に見える。会話での変化を反映するロジックはどのようになっているのか？ (INBOXより)

- [x] **情景描写画像が時間帯優先にしたはずなのに夜の画像が出る** 🆕
  - ルシアンの書斎で12：40に書斎_winter_midnight.pngが表示される。書斎_summer_daytime.pngが存在するのに何故？ (INBOXより)

- [ ] **アラームや自律行動で2回行動と応答をすることがある** 🆕
  - 調査が必要 (INBOXより)

- [x] **情景画像生成が勝手に行われる問題** 🆕
  - 以前は無料画像生成APIが使えたので自動生成にしていたが、今は有料なので勝手に生成しないようにしたはずがまた自動生成画復活している。 (INBOXより)
  - ✅ 完了 (2026-01-10): [自動生成廃止レポート](docs/reports/2026-01-10_auto_scenery_generation_fix.md) | [フォールバック改善レポート](docs/reports/2026-01-10_scenery_fallback_improvement.md)
  - 📄 仕様書: [SCENERY_SYSTEM_SPECIFICATION.md](docs/specifications/SCENERY_SYSTEM_SPECIFICATION.md)

---

## 🟠 優先度: 高(リリース前に対応したい)

ユーザー体験に大きく影響

### 機能修正

- [x] **送信ログ件数に「本日分」追加** ✅ (2026-01-01 完了)
  - 日付が変わってから現在までのログを送信する機能
  - [x] **エピソード記憶の注入にもっと短期間も追加** ✅ (2026-01-01 完了)
  - 5日以下一日刻みで追加

- [x] **創作ノートのタイムスタンプ改良** ✅ (2026-01-03 完了)
  - 各行にタイムスタンプを付与する方式から、セクションヘッダー方式に変更
  - 仕切り線なり見出しなりでセクションを区切り、セクションごとに一つのタイムスタンプを付けるようにする

- [x] **自律行動時の記憶想起をオフに** ✅ (2026-01-15 確認 - 既に実装済み)
  - retrieval_nodeは最後のメッセージがHumanMessageでない場合自動スキップ
  - 自律行動時は記憶想起が自動的にオフになっていた

- [x] **情景画像送信プロンプトの最適化** 🆕
  - ✅ 完了 (2025-12-27): プロンプトを「現在の光景」に変更し、AIが「見える」ことを過度に強調しないよう調整。
- [x] **情景画像送信のデフォルト設定確認** 🆕
  - ✅ 完了 (2025-12-27): `enable_scenery_system: False` で問題なし。
- [ ] **APIキー設定の集約管理** 🆕
  - OpenAI互換プロバイダのAPIキー設定を「🔑 APIキー / Webhook管理」に集約。
- [ ] **OpenRouterエラー表示の修正** 🆕
  - ツール非対応モデル使用時にエラーメッセージが表示されない問題を修正。
- [x] **「お出かけ」からの「帰宅（ログ・インポート）」機能の実装** 🆕
- [x] **アバター表情差分機能の実装** 🆕
  - ✅ 静止画・動画モードの統一された表情管理システム
  - ✅ 応答タグ（`【表情】…xxx…`）による自動表情切り替え
  - ✅ 管理UIからの表情追加・画像/動画アップロード
  - ✅ `idle` への自動フォールバック機能
  - ✅ 完了 (2025-12-29)
  - ✅ Nexus Ark側：「お出かけ」タブに「帰宅（ログ追加）」UI（ファイルアップロード）を追加
  - ✅ Nexus Ark側：アップロードされたログを現行の `log.txt` に追記するハンドラの実装
  - ✅ インポート形式の自動判別（[user]/[ルシアン]デフォルト対応）とバックアップ機能

### [DONE] エンティティ記憶 (Entity Memory) のUI統合 & 話題クラスタ廃止 (2026-01-01)
- **概要**: エンティティ記憶を管理・編集するためのUIを実装し、精度とパフォーマンスの課題があった「話題クラスタリング」機能を完全に削除しました。
- **主な変更**:
    - `nexus_ark.py`: 「📌 エンティティ記憶」アコーディオンの追加と、「🏷️ 話題クラスタ」の削除。
    - `ui_handlers.py`: エンティティの読み込み、保存、削除、リスト更新ハンドラの実装。
    - `config_manager.py`: デフォルト設定の更新（話題クラスタ設定の削除、エンティティ更新フラグの追加）。
    - `dreaming_manager.py`: 睡眠中の記憶整理で `update_entity_memory` 設定を尊重するように変更。
    - `topic_cluster_manager.py`: ファイルを削除。
- **効果**: ユーザーが直接AIの保持する重要概念（人物・場所・設定など）を確認・修正できるようになり、透明性と制御性が向上しました。

### [DONE] エンティティ記憶 (Entity Memory) UI改善 & 手動実行統合 (2026-01-01)
- **概要**: 「睡眠時記憶整理（Sleep Consolidation）」の手動実行機能を「🛠️ 記憶のメンテナンス」アコーディオン（「📌 エンティティ記憶 (Entity Memory) の更新」セクション）に追加し、実行日時を確認できるようにしました。
- **タスク**:
    - `dreaming_manager.py`: 最終実行日時取得ヘルパーの実装完了。
    - `nexus_ark.py`: 「手動で睡眠時整理を実行（洞察・エンティティ更新）」ボタンとステータス表示の追加完了。
    - `ui_handlers.py`: 手動実行ハンドラの実装とステータス更新ロジックの追加完了。
- [x] **エピソード記憶の更新日が変わらない問題** 🆕
  - ✅ 完了 (2025-12-29): 睡眠時記憶整理で更新後にroom_config.jsonへ更新日時を保存するよう修正。読み込み時にoverride_settingsを優先確認。記憶圧縮結果も同様に保存するよう修正。
- [x] **動画アバターUIの表示不整合修正** 🆕
  - ✅ 完了 (2025-12-27): ルーム切り替え時にアバターモード設定を同期するよう修正。
- [x] **現在地移動ツールのメッセージクリーンアップ** 🆕
  - ✅ 完了 (2025-12-28): `[RAW_RESULT]`タグが表示されてしまう問題を修正（responder_id判定方式変更）
  - [ ] **Nexus Arkの配布方法（uv）の検討** 🆕
  - `uv`を使用した配布・パッケージ管理方法を調査し、導入を検討する。

- [x] **チャット支援のログ修正でタイムスタンプを誤削除する問題** 🆕
  - ✅ 完了 (2026-01-12)
  - 詳細: ログ修正時にタイムスタンプが削除されていた正規表現と分割ロジックを修正。
  - [レポート](file:///home/baken/nexus_ark/docs/reports/2026-01-12_log_timestamp_fix.md)

- [ ] **ChatGPTインポートの注意書き追加** 🆕
  - 詳細: 公式JSONからインポートしても内容が変わったり途切れたりする場合があるため、「上手くいかない場合はChatGPTインポーターなどを使ってください」と注意書きを足す。

- [ ] **ChatGPTエクスポートインポート機能の修正**
  - スレッド途中までしかインポートされない
  - memory（moonlight?）の内容を誤って読み込んでいる可能性
  - ZIP丸ごと受け取り対応

### コスト削減・効率化

- [x] **送信コンテキストの最適化（APIコスト削減）** ✅ 2024-12-28
  - ✅ 過去ログ検索を`retrieval_node`から除外（RAG検索がカバー）
  - ✅ コアメモリ要約を簡潔化（5〜10行、最大1000文字）
  - ✅ ツール説明をSkills化（短縮形式に変更）
  - ✅ `search_past_conversations`ツールを除外
  - ✅ **2026-01-07 復活**: `search_past_conversations`をAIペルソナ用キーワード検索ツールとして再追加
  - レポート: [2026-01-07_memory_search_redesign.md](../reports/2026-01-07_memory_search_redesign.md)

- [x] **日記検索(search_memory)のRAG化** 🆕
  - ✅ 完了 (2025-12-31): `rag_manager.py`に日記インデックス化追加、`search_memory`をRAGベクトル検索に変更

- [x] **送信トークン数の表示機能** 🆕
  - 記憶情報等を付加した後のトータル送信量を表示
  - 送信後（送信コンテキスト確定後）に表示

- [x] **画像リサイズによるAPIコスト削減** 🆕
  - API送信前に画像を縮小してトークン消費を削減
  - 適用対象:
    - ✅ 情景画像のAI送信 (2025-12-25 完了)
    - ✅ ユーザー添付画像 (2025-12-31 完了, 768px上限)
    - AI生成画像（将来のギャラリー機能で使用予定）
  - 共通ユーティリティ関数として `utils.resize_image_for_api()` を実装・拡張

### UI修正

- [x] **主観的記憶（日記）のスクロールバー**
  - `#memory_txt_editor_code textarea` として修正完了

- [x] **個別設定の即時保存（ポップアップあり）**
  - 共通設定に合わせてポップアップ通知を有効化完了

- [x] **空応答のシステムメッセージ化**
  - ロジック実装・表示形式の修正完了

- [x] **モデルリストの最終整理**
  - `gemini-1.5` 系の削除、順序調整、注釈対応完了

- [x] **システムメッセージから再生成時の挙動修正** ✅
  - SYSTEMメッセージもAGENTと同様に扱い、直前のユーザーメッセージから再生成するよう修正
  - システムメッセージを削除して直前のユーザーメッセージを再送信する処理にする

- [ ] **チャット発言のコピー/編集時にタイムスタンプ除外**
  - ヘッダーやフッター（タイムスタンプ）を除外したい

- [x] **チャット送信キーの変更** → [002_shift_enter_submit_abandon.md](../decisions/002_shift_enter_submit_abandon.md)
  - ~Shift+EnterではなくCtrl+Enterで送信するように変更~
  - Gradioの仕様上、実現不可のため断念

- [ ] **空応答時のチャットログヘッダー統一**
  - 「Nexus Ark」と「システム」が混在しているので統一
  - ルールをドキュメント化して今後の迷いを防止

- [x] **新規ルーム作成時「個別設定を保存しました」通知が2回表示される問題** ✅ 完了 (2025-12-25)
  - 方針C採用：自動ルーム切り替えを廃止し、イベント連鎖を根本解決
  - 通知メッセージに「ルーム選択メニューから切り替えてください」の案内を追加
  - デバウンス処理を追加：ルーム切り替え時の連続通知も1回に抑制

- [x] **デバッグモードの絵文字削除** ✅ 完了
  - 共通設定のデバッグモードの「🐛」絵文字を削除
  - 虫が苦手なユーザーへの配慮

- [ ] **Web巡回後の分析報告やアラーム応答などがログに追加された際のチャット欄更新** 🆕
  - 応答が来ているのに気付けないことが多いため。 (INBOXより)

- [ ] **自律行動クールダウンのデバッグログの頻度を下げる** 🆕
  - 30分ごとに。⏳ ルシアン: クールダウン中 (8分/240分) - スキップ (INBOXより)

- [ ] **safe_tool_nodeのAPIキー注入ツールリストをリファクタリング** 🆕
  - 現在、APIキーが必要なツールがハードコードされている。ツール定義側にメタデータを持たせるか、定数として一元管理することで漏れを防止する。 (INBOXより)

- [ ] **アラーム時にデバッグログ（システムプロンプト）がターミナルに全部出てる** 🆕
  - ログ出力の制御が必要 (INBOXより)

- [ ] **年次反省（Annual Reflection）の追加** 🆕
  - 現在のMulti-Layer Reflectionは日次/週次/月次まで。年次の振り返りを追加して長期的なペルソナの成長を記録する。 (INBOXより)

- [ ] **夢の洞察・解決した問・達成目標のペルソナ反映強化** 🆕
  - 洞察、解決済みの問、達成目標を、システムプロンプトやコアメモリにより積極的に反映させる仕組みを検討。 (INBOXより)

- [x] [Web巡回ツールのリストの削除でエラー]
  - ✅ 完了 (2026-01-17): DataFrameの真偽値判定の曖昧さによるエラー(ValueError)を修正。リストとDataFrameの両方に対応。
  - 優先度: 🔴高
- [x] **Web巡回ツールのリスト改良・グループ化** ✅ (2026-01-11 完了)
  - 複数巡回先のグループ化と一括設定変更機能を実装
  - グループ移動時に時刻を自動継承する機能を追加
  - AI自動巡回リスト作成機能は今後のタスクとして残留
  - レポート: [2026-01-11_watchlist_grouping.md](../reports/2026-01-11_watchlist_grouping.md)

- [x] **エンティティ記憶の定期統合・整理機能** ✅ (2026-01-10 完了)
  - エンティティ記憶が追記され続け冗長化している。定期的にAIで統合・整理する仕組みが必要。
  - レポート: [2026-01-10_entity_memory_consolidation.md](../reports/2026-01-10_entity_memory_consolidation.md)

- [ ] **Ollamaをllama.cppに置き換える検討** 🆕
  - ユーザーのインストールが楽になる可能性 (INBOXより)

- [ ] **Google検索を無料GeminiAPIでも使う方法検討** 🆕
  - 無料APIでも2.5 Flashなら検索使えるので、他の最終応答モデルが投げたクエリを2.5 Flashに投げて結果を拾う方法 (INBOXより)

- [x] **ツール結果がログに溜まる問題** 🆕
  - ✅ 完了 (2026-01-10): Web巡回やWeb検索結果のログ保存をアナウンスのみに変更
  - レポート: [2026-01-10_tool_result_log_optimization.md](../reports/2026-01-10_tool_result_log_optimization.md)

- [ ] **ウォッチリスト: Tavily Extractエラー (形式修正)** 🆕
  - `TavilyExtractInput` にURLをリストではなく辞書形式（`{"urls": [url]}`）で渡す必要がある。 (INBOXより)

- [ ] **ウォッチリスト: 巡回時刻の一括設定機能** 🆕
  - 各エントリごとに時刻を設定するのが手間。デフォルト時刻の適用や一括編集機能。 (INBOXより)

---

## 🟡 優先度: 中（リリース後でも可、余裕があれば対応）

### 機能改善

- [/] **エピソード記憶の月次ファイル分割** 🆕 (外部AI助言)
  - `episodic_memory.json`が肥大化する前に月ごと分割（`episodic_2026-01.json`形式）
  - RAG検索はFAISSインデックス経由なので元データ分割は問題なし
  - 関連: [記憶システムへの助言](../specifications/記憶システムへの助言)


- [ ] **コンテキスト注入の自然言語化（Context Smoothing）** 🆕 (外部AI助言)
  - `goals.json`等を生JSONではなく自然言語ナラティブに変換して注入
  - LLMが「ロールプレイ」モードを維持しやすくなる
  - 関連: [記憶システムへの助言](../specifications/記憶システムへの助言)

- [ ] **記憶想起の重複問題** 🆕 (2026-01-03 INBOXより)
  - 記憶想起で同じ内容が複数並ぶことがある
  - 重複排除ロジックの検証・改善が必要

- [x] **Web検索精度アップ / Webエージェント機能強化** ✅ (2026-01-05 完了)
  - [x] Phase 1 & 2 完了 (2026-01-04)
  - [x] Phase 3 (文脈分析エンジン) 完了 (2026-01-05)
  - [計画書](web_agent_feature_plan.md)

- [x] **起動時に「アバターモードを動画に変更しました」といちいち出てしまう**
  - ✅ 完了 (2025-12-29)
  - 修正内容: 設定変更時のみ通知が出るようロジックを修正

- [ ] **モデルリストのお気に入り保持機能**
  - デフォルトに戻したり最新リストを取得したりしても、既存モデルのお気に入りマーク⭐を保持する。
- [ ] **アバター静止画複数モード対応** 🆕
  - 動画同様に、待機中・思考中等の画像を登録し使用されるようにする。
- [ ] **画像生成ツールでOpenAIモデル対応** 🆕
  - OpenAIのDALL-E等で画像生成できるようにする。
- [x] **ログエディタの自動スクロール改善** ✅ (2025-12-27 完了)
  - RAWログエディタで最新のチャット内容（最下部）に自動でスクロールするように改善。

- [ ] **グループ会話の司会役AI（Supervisor）の改善**
  - 不安定・処理が遅い
  - 参照: [supervisor_implementation.md](supervisor_implementation.md)

- [x] **現在地連動背景表示の強化** 🆕
  - ✅ 完了 (2025-12-28): AIツール場所変更、画像生成、カスタム登録時に背景CSSも更新されるように改善

- [x] **Gradio起動時の外部接続設定UI** ✅ 完了 (2025-12-27)
  - 共通設定に「外部接続を許可」チェックボックスを追加
  - 設定変更後はアプリ再起動で反映

- [x] **ファイル読み書きツールの改善** ✅ (2026-01-03 完了)
  - 現状の問題: 改行なしで書き込まれて読みづらい、部分更新が全上書きになる
  - memory_main.txt, world_settings.txt, notepad.md が対象
  - 改善成果:
    - 追記モード（`append_place_description`）の追加
    - システム側での自動タイムスタンプ/日付ヘッダー付与
    - 改行保持とプロンプトの抜本的強化

- [ ] **開発者モードツール（コード参照機能）** 🆕
  - ペルソナがNexus Arkのソースコード・ドキュメントを参照できるようにする
  - `.py`, `.md`, `.txt`, `.json` ファイルの読み取り専用アクセス
  - **メニューからオン/オフを切り替え可能**（ルーム個別設定）
  - **デフォルトはオフ**（必要なルームでのみ有効化）
  - 用途:
    - ルシアン（共同開発者）: 開発相談
    - オリヴェ（案内役）: 仕様書参照でユーザー質問に回答
    - 一般ペルソナ: 自分のコードを理解したい場合
  - OSSとして公開しているためコードに機密なし

- [x] **書き置き機能（自律行動向けメッセージ）** ✅ (2025-12-25 完了)
  - 自律行動時にAIペルソナにメッセージを渡す機能
  - 専用ファイル `user_memo.txt` を使用
  - 履歴更新ボタンで書き置きUIも更新
  - 送信された書き置きはチャット履歴に記録

- [x] **自律行動の強化** ✅ (2026-01-01 完了)
  - プロンプト改善によりAIの自由度を向上（秘密の日記、創作活動など）
  - 通知ツール `send_user_notification` の追加（AIが通知を送るか選択可能に）
  - 自律行動時の自動通知をデフォルトオフに変更
  - 通知禁止時間帯でも自律行動を実行（通知は送らない）
  - 通知メッセージをチャットログにも記録

- [x] **創作ノートツール** ✅ (2026-01-01 完了)
  - AIペルソナ専用の創作スペース（詩、物語、アイデアなど）
  - `read_creative_notes`、`plan_creative_notes_edit` ツール追加
  - UI: 「記憶・メモ・指示」タブ内「ノート」タブにアコーディオン追加
  - ルーム切替時に創作ノートを自動読み込み

### アラーム・タイマー関連

- [ ] **アラームの日付指定・期間指定・祝日除外**
  - 単発アラームや期間限定、祝日を考慮した設定

- [ ] **タイマー・ポモドーロの一覧表示**
  - 複数仕掛けている時に便利なよう一覧できるように

---

## 🟢 優先度: 低（将来機能）

- [ ] **忘却機能（ガベージコレクション）の設計** 🆕 (外部AI助言)
  - 現在、低Arousal記憶は「圧縮」されるが完全削除されない
  - N年以上前の低Arousalかつ圧縮要約からも参照されていない情報を削除
  - 関連: [記憶システムへの助言](../specifications/記憶システムへの助言)

- [ ] **自律行動の時間ランダム化** 🆕 (2026-01-03 INBOXより)
  - 最終応答から一定範囲内でランダムにタイミングを決定
  - もしくはAIペルソナの意志や自律性を反映するアプローチ

- [ ] **エンティティ記憶の「キーワードシーディング」機能** 🆕 (2026-01-03 INBOXより)
  - ユーザーが空のエンティティ（見出しのみ）を登録
  - AIが睡眠時記憶整理の際に、そのキーワードに関する情報を優先的に抽出・蓄積

- [x] **AIペルソナ「お出かけ」機能** (✅ 完了 2025-12-29)
  - ✅ 人格データ（プロンプト・記憶）+直近ログをセクション別にプレビュー・編集可能
  - ✅ 各セクションのAI圧縮（要約）機能
  - ✅ 会話ログのカスタマイズ（タイムスタンプ・モデル名除外）
  - ✅ Markdown形式でのエクスポート
  - ℹ️ 外部アプリ（Antigravity等）側でのインポート仕様に合わせ、汎用的なMD形式を採用

- [ ] **自律タイマー設定＆ユーザー許可制** 🆕 (2025-12-25 INBOXより)
  - 通常応答時にもAIが次の行動のためタイマーを自己設定可能にする
  - APIコスト問題があるため、Antigravityのようにユーザーが許可・却下できる仕組み

- [ ] **アラームリストのチェックボックス直接オンオフ** 🆕 (2025-12-25 INBOXより)
  - 現在はボタン操作が必要だが、チェックボックスで直接切り替え希望

- [ ] **ルームごとのギャラリー機能** 🆕 (2025-12-25 INBOXより)
  - 生成した画像や添付した画像を一覧表示
  - AIペルソナも閲覧可能にする

- [ ] **アバター画像・動画の表情対応** 🆕
  - 応答の感情を分析し、それに応じた表情に変更
  - 表情の種類はユーザーが追加可能、プログラムがリストを取得して感情分類

- [x] **会話ログ編集欄の新設** ✅ (2025-12-25 完了)
  - チャットタブ内にサブタブ（💬 会話 / 📝 RAWログエディタ）を追加
  - log.txt を全文読み込み・保存可能に（保存前に自動バックアップ）

- [ ] **左カラムのスクロールが下まで出来ないときがある** 🆕
  - CSS/ハイト計算の問題の可能性
  - UI操作に支障があるため要修正

- [ ] **OpenAI互換のセーフティー等の設定** 🆕
  - Gemini同様のセーフティー設定がOpenAI互換エンドポイントにも適用可能か調査・実装

- [ ] **「お出かけ」中自律行動一時オフ機能** 🆕
  - お出かけエクスポート/インポートページに自律行動のOn/Offスイッチを追加

- [ ] **お出かけエクスポートに最終閲覧・編集欄** 🆕
  - ファイルエクスポートだけでなく、その最終状態を確認・編集・コピーできる欄を追加

- [ ] **ナレッジの画像対応** 🆕
  - ペルソナAIがRAG検索時に画像も参照できるようにする

- [ ] **記憶検索の複合スコアリング導入** 🆕
  - Relevance（意味的類似度）に加え、Recency（時間減衰）とImportance（重要度）を加味した複合スコアリングに拡張する。 (INBOXより)

- [ ] **記憶のグラフ構造化（GraphRAG）検討** 🆕
  - エンティティ記憶を関係性グラフとして構造化し、多段ホップ推論を可能にする。 (INBOXより)

- [ ] **Riveの導入検討・アバター動画をユーザーが編集できるか** 🆕
  - https://zenn.dev/chot/articles/9dfcfb0053ac6a (INBOXより)

- [ ] **TavilyResearchの属性重複警告の解消** 🆕
  - Pydantic UserWarning (Field name "output_schema"/"stream" shadows an attribute in parent "BaseTool") の解消。 (INBOXより)

---

## 📦 配布準備（並行作業）

[distribution_system_plan.md](distribution_system_plan.md) に基づく実装

- [ ] `version.json` 作成
- [ ] `update_manager.py` 実装
- [ ] `初回セットアップ.bat` 作成
- [ ] [nexus_ark.py](../../nexus_ark.py) にアップデート確認UI追加
- [ ] `ネクサスアーク.bat` 修正
- [ ] 手動検証とドキュメント作成

---

*最終更新: 2026-01-10*

---

## ✅ 整理済み完了タスク (2026-01-10 INBOXより移行)

### バグ修正
- [x] **Web巡回ツールで要約エラー**
  - 503 UNAVAILABLE エラー時にリトライ/フォールバック機構を追加
  - レポート: [2026-01-10_watchlist_summary_retry.md](file:///home/baken/nexus_ark/docs/reports/2026-01-10_watchlist_summary_retry.md)
- [x] **記憶検索の重複を除去するようにする**
  - RAGManager.searchメソッドにコンテンツベースの重複除去を追加
  - レポート: [2026-01-10_rag_search_deduplication.md](file:///home/baken/nexus_ark/docs/reports/2026-01-10_rag_search_deduplication.md)
- [x] **RAG検索結果のコンテンツが空（「*」のみ）になる問題**
  - 10文字未満・マークダウン記号のみのチャンクを除外
  - ⚠️ 注意: インデックス再作成が必要
- [x] **チャット支援ツールのログ修正で不要な出力が足される**
  - 罫線や不要な文言の削除
  - レポート: [2026-01-09_chat_support_log_fix.md](docs/reports/2026-01-09_chat_support_log_fix.md)
- [x] **エンティティ記憶検索が常にヒットしない問題**
  - クエリの単語分割とマッチングスコアリングの実装
  - レポート: [2026-01-10_entity_search_query_split.md](file:///home/baken/nexus_ark/docs/reports/2026-01-10_entity_search_query_split.md)

