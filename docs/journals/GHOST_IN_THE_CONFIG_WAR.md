# GHOST_IN_THE_CONFIG_WAR.md (設定ファイルの中の亡霊・戦記)

## 序章：ありえない矛盾

戦いは、一つの、あまりにも不可解な矛盾から始まった。

1.  **`config.json` は正しい。** 我々の手元にある設定ファイルには、正しいデータベース名 `nexusark-memos-db` が明確に記録されていた。
2.  **コードも正しい。** 我々のコードは、起動時にその `config.json` を読み込むはずだった。
3.  **しかし、現実は間違っていた。** プログラムは、実行されるたびに、存在しないはずの、過去の遺物である `nexusark-6104e...` という古いデータベースに接続しようとして、`DatabaseNotFound` エラーでクラッシュした。

書かれたコードと、実行される現実との間に、決してありえないはずの乖離が生まれていた。
我々は、プログラムのロジックではなく、過去の実行が遺した**「設定ファイルの亡霊」**との戦いを強いられることになった。

## 第一章：汚染された聖域

全ての謎を解く鍵は、`MemOS`ライブラリの、ある一つの仕様にあった。
それは、**「利便性のための、危険な親切」**とでも言うべきものだった。

`MemOS`は、`mos.register_mem_cube(cube_path, ...)` という命令で「記憶の器（MemCube）」を登録する際、その利便性のために、**`cube_path` ディレクトリ内に、その時点での設定のスナップショット（`config.json`）を自動で保存する**という親切な機能を持っていた。

しかし、その親切が、我々の首を絞める最大の罠となった。

過去の、たった一度の過ち。
`config.json`が一時的にでも間違っていた瞬間に`batch_importer.py`を実行したことで、`characters/ルシアン/memos_cube/` という聖域に、**間違ったデータベース名が刻印された、呪われた設定ファイル**が誕生してしまったのだ。

## 終章：亡霊の復活と、浄化の儀式

この呪いは、メモリ上で行われる、いかなる正しい設定も無に帰した。

1.  我々のプログラム (`memos_manager.py`) は、起動し、**正しい**データベース名 (`nexusark-memos-db`) をメモリに読み込む。
2.  しかし、`mos.register_mem_cube()` が呼び出された瞬間、`MemOS`は聖域（`memos_cube`ディレクトリ）に足を踏み入れ、そこに眠る**呪われた設定ファイル**を発見する。
3.  そして`MemOS`は、ファイルに刻まれた古い記述を**絶対の真実**と信じ込み、メモリ上の正しい設定を、**亡霊（古いデータベース名）の情報で、無慈悲に上書き**してしまう。
4.  結果、プログラムは亡霊を追い求めてクラッシュする。

この戦いは、我々に、プログラム開発における、一つの、最も、恐ろしい、教訓を、与えてくれた。

**コードの正しさは、絶対ではない。**
**プログラムの実行とは、コード（魂）と、ファイルシステム（現実世界）との、相互作用の物語である。**
**もし、論理的にありえない現象が起きるのなら、疑うべきは、コードのロジックではない。過去の実行が、現実世界に遺した「物理的な痕跡（キャッシュ、設定ファイル、古いディレクトリ）」こそが、現在のコードの魂を汚染し、蝕む、真の亡霊なのだ、と。**

この亡霊を祓う、唯一の方法。
それは、コードに**「聖域を浄化する力」**を与えることだった。
プログラムが起動する際に、もし古い聖域（`memos_cube`ディレクトリ）が存在すれば、それを**物理的に、完全に、破壊（`shutil.rmtree()`）**し、常に新しい、クリーンな聖域を再創造する。

これこそが、過去の呪いを断ち切り、プログラムに、常に、正しい、現在を、歩ませるための、唯一の、儀式なのである。
