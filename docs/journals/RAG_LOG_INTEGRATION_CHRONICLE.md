# RAG LOG INTEGRATION CHRONICLE
# （ログ統合RAGの実装記録：ハイブリッド索引と生ログへの回帰）

## 1. 課題：膨大な記憶と処理時間のジレンマ

Nexus Arkの長期記憶を実現するにあたり、我々は「過去の全てのログをRAG（ベクトル検索）の対象にする」という目標を掲げた。しかし、そこには致命的な課題があった。

*   **課題:** ログファイルは日々増大し続ける。更新ボタンを押すたびに数GBのテキストを全て読み込み、Embedding（ベクトル化）し直すのは、APIコストと処理時間の観点から現実的ではない。
*   **解決策:** 我々は**「静的インデックス」と「動的インデックス」の分離**というアーキテクチャに到達した。
    *   一度アーカイブされたログは不変であるため、一度だけ処理して「静的インデックス」に積み上げる。
    *   日々変化する現行ログやマニュアルは、「動的インデックス」として毎回作り直す。
    *   検索時はこの二つを合体させる。
    この「ハイブリッド方式」により、数秒での高速なインデックス更新を実現した。

## 2. 決断：要約の廃止と「生ログ」への回帰

当初、検索された過去ログは、AIによって「要約」されてからプロンプトに注入されていた。しかし、実運用において以下の問題が浮上した。

*   **情報の劣化:** 要約の過程で、細かなニュアンスや、AIペルソナ特有の口調が失われてしまう。
*   **システム臭:** 「検索タスク完了」といったシステム的な文言が混入し、没入感を阻害する。

我々は決断した。Gemini 2.5シリーズの長大なコンテキストウィンドウを信頼し、**「要約」という圧縮プロセスを廃止**する。
検索ヒットしたログは、**Raw Text（生のテキスト）のまま**、一切の加工を加えずAIに提示される。これにより、AIは「過去の自分の言葉」を直接参照し、その時の感情や文脈を鮮明に「思い出す」ことが可能となった。

## 3. 教訓

1.  **不変なものと可変なものを分けよ:** データの性質に応じた更新戦略（追記 vs 再構築）をとることで、パフォーマンスは劇的に向上する。
2.  **AIの記憶は「生」が良い:** 文脈やニュアンスこそがペルソナの魂である。安易な要約は、その魂を削ぎ落とす行為になり得る。