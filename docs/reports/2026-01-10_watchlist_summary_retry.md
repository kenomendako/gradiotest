# Web巡回ツール要約エラー対応

## 概要
ウォッチリスト定期巡回時に発生する503 UNAVAILABLE（モデルオーバーロード）エラーへのリトライ/フォールバック機構を実装。

## 問題
- **現象**: Gemini APIが一時的に過負荷状態の時、`_summarize_watchlist_content`関数が「要約生成失敗」を返す
- **影響**: ペルソナAIに不完全な情報が渡され、状況把握が困難に

## 修正内容

### `alarm_manager.py` - `_summarize_watchlist_content`関数

| 項目 | 変更前 | 変更後 |
|------|--------|--------|
| エラー処理 | 即座に「要約生成失敗」を返す | リトライ後にフォールバック |
| リトライ | なし | 最大3回（指数バックオフ: 1→2→4秒） |
| フォールバック | なし | コンテンツ冒頭500文字を返す |
| ペルソナへのガイド | なし | 「追加調査してください」のメッセージ付与 |

### リトライ対象エラー
- 503 UNAVAILABLE
- 429 Too Many Requests  
- "overloaded" / "unavailable" を含むエラー

### フォールバック出力例
```
[コンテンツ冒頭500文字]

---
⚠️ **注意**: 要約APIが一時的に利用できないため、コンテンツ冒頭のみを抜粋しています。
詳細が必要な場合は、URLを直接確認するかWeb検索ツールで追加調査してください。
```

## 変更ファイル

| ファイル | 変更内容 |
|----------|----------|
| `alarm_manager.py` | `_summarize_watchlist_content`関数にリトライ/フォールバック追加 |

## 検証結果
- ✅ 構文チェック (`py_compile`) 成功
- ⏳ 実際の503エラー発生時の動作は運用中に確認予定

## 残課題
なし
