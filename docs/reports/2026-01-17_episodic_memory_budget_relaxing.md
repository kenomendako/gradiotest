# エピソード記憶の分量調整（予算緩和）

**日付:** 2026-01-17  
**ブランチ:** `feat/relax-episodic-budget`  
**ステータス:** ✅ 完了

---

## 問題の概要

エピソード記憶の肥大化対策として導入したArousalベースの文字数制限（50/150/300文字）が厳しすぎ、重要な会話の詳細や文脈が損なわれる「圧縮しすぎ」の状態になっていました。
この問題を解消するため、文字数予算を従来の約2倍に緩和し、より詳細な記録を保持できるように調整しました。

---

## 修正内容

1. **予算の定数化と緩和**: 
   - `constants.py` に `EPISODIC_BUDGET_HIGH/MEDIUM/LOW` を定義。
   - 数値を 600 / 350 / 150 文字に引き上げました。
2. **要約プロンプトの改善**:
   - 日次要約の記述量を「3-5行」から「5-8行」へ増加。
   - 具体的な会話内容や情感豊かな表現を優先的に残すよう指示を強化。
3. **ガードレールの自動調整**:
   - 文字数オーバー時の強制カット閾値を、予算の1.2倍程度に緩和。
4. **仕様書の更新**:
   - `MEMORY_SYSTEM_SPECIFICATION.md` の規定値を最新化。

---

## 変更したファイル

- `constants.py` - 文字数予算の定数追加
- `episodic_memory_manager.py` - 要約ロジックとプロンプトの更新
- `docs/specifications/MEMORY_SYSTEM_SPECIFICATION.md` - 仕様書の更新
- `docs/plans/research/episodic_memory_memrl_study.md` - 研究メモの更新

---

## 検証結果

- [x] アプリ起動確認：正常にビルド・起動
- [x] 機能動作確認：2026-01-16 のエピソードにおいて、約650文字の詳細な要約が生成されていることを実データで確認
- [x] 副作用チェック：他ファイルへの影響なし

---

## 残課題（あれば）

なし。今回の調整で、以前の「数千文字」と最近の「数十文字」の中間である「数百文字（500文字前後）」の安定した出力を確認しました。
