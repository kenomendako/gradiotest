# 画像生成マルチプロバイダ対応

**日付:** 2026-01-31  
**ブランチ:** `feat/image-generation-multi-provider`  
**ステータス:** ✅ 完了

---

## 問題の概要

画像生成機能を複数のプロバイダ（Gemini、OpenAI互換、無効）から選択可能にし、有料キーチェックを撤廃してシンプルなプロバイダ・モデル選択方式に刷新する。

---

## 修正内容

### 1. マルチプロバイダ対応
- **Gemini**: gemini-2.5-flash-image 等の新モデルをサポート
- **OpenAI互換**: gpt-image-1、dall-e-3 等をサポート（プロファイル選択方式）
- **無効**: 画像生成機能を完全に無効化

### 2. プロファイル選択方式
- OpenAI互換画像生成で個別APIキー入力ではなく、既存のAPIキー管理プロファイルを使用
- APIキー管理の一元化

### 3. gpt-image-1対応
- `response_format`パラメータをサポートしないが`b64_json`で返すモデルへの対応
- URL方式とb64_json方式の両対応

### 4. 照明指示の改善
- 情景描写プロンプトに時間帯に応じた明示的な照明指示を追加
- 昼間は明るい自然光、夕方はゴールデンアワー、夜は月光等を指定

---

## 変更したファイル

| ファイル | 変更内容 |
|---------|---------|
| `config_manager.py` | 画像生成設定キー追加 |
| `tools/image_tools.py` | マルチプロバイダ対応、gpt-image-1対応 |
| `ui_handlers.py` | 設定保存ハンドラ、情景描写対応、照明指示改善 |
| `nexus_ark.py` | 画像生成設定UI刷新 |

---

## 検証結果

- [x] アプリ起動確認
- [x] Gemini画像生成（情景描写）
- [x] OpenAI互換画像生成（gpt-image-1）
- [x] ワイヤリング検証（既存警告は無関係）

---

## 残課題

なし
