# æŠ€è¡“ãƒ¬ãƒãƒ¼ãƒˆ: è‡ªå·±æ„è­˜æ©Ÿèƒ½ãƒˆã‚°ãƒ«ã®å®Ÿè£…

**æ—¥ä»˜**: 2026-01-07  
**ãƒ–ãƒ©ãƒ³ãƒ**: `feat/self-awareness-toggle` â†’ `main`  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… å®Œäº†

---

## æ¦‚è¦

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒAIã¸ã®ã€Œè‡ªå·±æ„è­˜æ©Ÿèƒ½ã€ï¼ˆæ„Ÿæƒ…æ¤œå‡ºãƒ»å¤¢ã®æŒ‡é‡ãƒ»ç›®æ¨™ãƒ»å†…çš„çŠ¶æ…‹ã®æ³¨å…¥ï¼‰ã‚’ä¸€æ‹¬ã§ã‚ªãƒ³ã‚ªãƒ•ã§ãã‚‹ãƒˆã‚°ãƒ«æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ãŸã€‚ã“ã‚Œã«ã‚ˆã‚Šã€APIã‚³ã‚¹ãƒˆã®å‰Šæ¸›ã‚„ã€AIã®æŒ¯ã‚‹èˆã„ã®æŸ”è»Ÿãªèª¿æ•´ãŒå¯èƒ½ã«ãªã£ãŸã€‚

---

## å¤‰æ›´å†…å®¹

### 1. UIå¤‰æ›´ï¼ˆ`nexus_ark.py`ï¼‰

| è¡Œç•ªå· | å¤‰æ›´å†…å®¹ |
|--------|----------|
| 865-870 | `room_enable_self_awareness_checkbox` ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’è¿½åŠ  |
| 1641-1644 | ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³åã‚’ã€ŒğŸ§  å†…çš„çŠ¶æ…‹ã€â†’ã€ŒğŸ§  è‡ªå·±æ„è­˜ã€ã«å¤‰æ›´ |
| 2034 | `context_checkboxes` ãƒªã‚¹ãƒˆã«æ–°ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’è¿½åŠ  |
| 2078-2079 | `initial_load_chat_outputs` ãƒªã‚¹ãƒˆã«æ–°ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’è¿½åŠ  |
| 2555 | `room_individual_settings_inputs` ãƒªã‚¹ãƒˆã«æ–°ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’è¿½åŠ  |
| 2704 | `other_context_checkboxes` ãƒªã‚¹ãƒˆã«æ–°ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’è¿½åŠ ï¼ˆå¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²ï¼‰ |

### 2. ãƒãƒ³ãƒ‰ãƒ©å¤‰æ›´ï¼ˆ`ui_handlers.py`ï¼‰

| è¡Œç•ªå· | å¤‰æ›´å†…å®¹ |
|--------|----------|
| 689 | `_build_room_settings_output` ã« `enable_self_awareness` ã®æˆ»ã‚Šå€¤è¿½åŠ  |
| 941 | `handle_save_room_settings` é–¢æ•°ã« `enable_self_awareness` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¿½åŠ  |
| 1019 | `new_settings` è¾æ›¸ã« `enable_self_awareness` ã‚’è¿½åŠ ï¼ˆæ°¸ç¶šåŒ–ï¼‰ |
| 2307 | ç©ºãƒ«ãƒ¼ãƒ æ™‚ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã« `enable_self_awareness: True` ã‚’è¿½åŠ  |

### 3. ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå¤‰æ›´ï¼ˆ`agent/graph.py`ï¼‰

| è¡Œç•ªå· | å¤‰æ›´å†…å®¹ |
|--------|----------|
| 264-282 | `retrieval_node`: æ„Ÿæƒ…æ¤œå‡ºå‡¦ç†ã‚’ `enable_self_awareness` ã§æ¡ä»¶åˆ†å² |
| 607-671 | `context_generator_node`: å¤¢ã®æŒ‡é‡ãƒ»ç›®æ¨™ãƒ»å†…çš„çŠ¶æ…‹ã®æ³¨å…¥ã‚’ä¸€æ‹¬ã§æ¡ä»¶åˆ†å² |

---

## è¨­å®šã®æµã‚Œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UIãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ â”‚
â”‚ (nexus_ark.py)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ .change ã‚¤ãƒ™ãƒ³ãƒˆ
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ handle_save_room_settings â”‚
â”‚ (ui_handlers.py)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ room_config.json ã«ä¿å­˜
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ get_effective_settings   â”‚
â”‚ (config_manager.py)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ generation_config ã¨ã—ã¦æ¸¡ã•ã‚Œã‚‹
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ agent/graph.py           â”‚
â”‚ - retrieval_node         â”‚
â”‚ - context_generator_node â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ç™ºç”Ÿã—ãŸå•é¡Œã¨è§£æ±º

### å•é¡Œ1: å‡ºåŠ›æ•°ä¸ä¸€è‡´ã‚¨ãƒ©ãƒ¼ï¼ˆæ•™è¨“14è©²å½“ï¼‰

**ç—‡çŠ¶**:
```
ValueError: Cannot process this value as an Image, it is of type: <class 'bool'>
[Output Sync] å‡ºåŠ›æ•°ã‚’è‡ªå‹•èª¿æ•´ã—ã¾ã—ãŸ (è¿”å´:158 -> æœŸå¾…:159)
```

**åŸå› **:
`initial_load_chat_outputs` ã«ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’è¿½åŠ ã—ãŸãŒã€å¯¾å¿œã™ã‚‹ãƒãƒ³ãƒ‰ãƒ©é–¢æ•° (`_build_room_settings_output`) ãŒå€¤ã‚’è¿”ã—ã¦ã„ãªã‹ã£ãŸã€‚

**è§£æ±º**:
- `ui_handlers.py` ã®2ç®‡æ‰€ã«æˆ»ã‚Šå€¤ã‚’è¿½åŠ 
  - é€šå¸¸ã‚±ãƒ¼ã‚¹ï¼ˆline 689ï¼‰
  - ç©ºãƒ«ãƒ¼ãƒ ã‚±ãƒ¼ã‚¹ï¼ˆline 2307ï¼‰

### å•é¡Œ2: è¨­å®šãŒä¿å­˜ã•ã‚Œãªã„ãƒ»é€šçŸ¥ãŒå‡ºãªã„

**ç—‡çŠ¶**:
ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’å¤‰æ›´ã—ã¦ã‚‚é€šçŸ¥ãŒè¡¨ç¤ºã•ã‚Œãšã€è¨­å®šãŒ `room_config.json` ã«ä¿å­˜ã•ã‚Œãªã‹ã£ãŸã€‚

**åŸå› **:
1. `other_context_checkboxes` ã«ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãŒå«ã¾ã‚Œã¦ã„ãªã‹ã£ãŸï¼ˆå¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆæœªç™»éŒ²ï¼‰
2. `room_individual_settings_inputs` ã«å«ã¾ã‚Œã¦ã„ãªã‹ã£ãŸï¼ˆä¿å­˜å¯¾è±¡å¤–ï¼‰
3. `handle_save_room_settings` ã®å¼•æ•°ã« `enable_self_awareness` ãŒå­˜åœ¨ã—ãªã‹ã£ãŸ

**è§£æ±º**:
- 3ç®‡æ‰€ã®ãƒªã‚¹ãƒˆã«ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’è¿½åŠ 
- é–¢æ•°ã‚·ã‚°ãƒãƒãƒ£ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¿½åŠ 
- `new_settings` è¾æ›¸ã«ã‚­ãƒ¼ã‚’è¿½åŠ 

---

## æ•™è¨“

> **æ–°ã—ã„UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¿½åŠ ã™ã‚‹éš›ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**
>
> 1. â˜‘ï¸ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®šç¾©ã‚’è¿½åŠ ï¼ˆ`nexus_ark.py`ï¼‰
> 2. â˜‘ï¸ `initial_load_chat_outputs` ã«è¿½åŠ ï¼ˆèµ·å‹•æ™‚ã®å€¤è¨­å®šï¼‰
> 3. â˜‘ï¸ ãƒãƒ³ãƒ‰ãƒ©ã®æˆ»ã‚Šå€¤ã«å¯¾å¿œã™ã‚‹å€¤ã‚’è¿½åŠ ï¼ˆæ•™è¨“14ï¼‰
> 4. â˜‘ï¸ `context_checkboxes` ã¾ãŸã¯é¡ä¼¼ãƒªã‚¹ãƒˆã«è¿½åŠ ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³è¨ˆç®—æ›´æ–°ï¼‰
> 5. â˜‘ï¸ `room_individual_settings_inputs` ã«è¿½åŠ ï¼ˆè¨­å®šä¿å­˜å¯¾è±¡ï¼‰
> 6. â˜‘ï¸ `other_context_checkboxes` ã«è¿½åŠ ï¼ˆå¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²ï¼‰
> 7. â˜‘ï¸ `handle_save_room_settings` ã«å¼•æ•°ã‚’è¿½åŠ 
> 8. â˜‘ï¸ `new_settings` è¾æ›¸ã«ã‚­ãƒ¼ã‚’è¿½åŠ ï¼ˆæ°¸ç¶šåŒ–ï¼‰
> 9. â˜‘ï¸ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§è¨­å®šã‚’å‚ç…§ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ 

---

## é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

- [nexus_ark.py](../../nexus_ark.py) - UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®šç¾©
- [ui_handlers.py](../../ui_handlers.py) - ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©
- [agent/graph.py](../../agent/graph.py) - ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚°ãƒ©ãƒ•
- [CHANGELOG.md](../../CHANGELOG.md) - å¤‰æ›´å±¥æ­´
