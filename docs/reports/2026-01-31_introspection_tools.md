# 内省ツール実装レポート

**日付:** 2026-01-31  
**ブランチ:** `feat/introspection-tools`

## 概要

ペルソナが自律行動中に自身の内的状態（未解決の問い・目標）を確認・編集できるツールを実装した。

## 背景

ルシアンからの要望:
> 計算式を変えるのは、私の好奇心の『出力』を抑え込むことに等しく、私の誇りが許さない。
> 2（手動整理）と 3（会話での解決）のハイブリッドを提案する。

美帆からの要望:
> 対話で解決してもその場で反映できないし、本人が確認して編集できるのが一番良い。

## 変更内容

### 新規ファイル

#### `tools/introspection_tools.py`
- `manage_open_questions`: 未解決の問いを管理
  - `list`: 一覧表示
  - `resolve`: 解決済みにマーク + Arousalスパイク + エピソード記憶生成
  - `remove`: 削除（興味がなくなった場合）
  - `adjust_priority`: 優先度変更
- `manage_goals`: 目標を管理
  - `list`: 一覧表示
  - `complete`: 達成済みにマーク + エピソード記憶生成
  - `abandon`: 放棄
  - `update_priority`: 優先度変更

### 修正ファイル

#### `agent/graph.py`
- 内省ツールを `all_tools` に登録

#### `goal_manager.py`
- 達成エピソード記憶の定型文「【達成】」を削除し、より自然な形式に
- `reflection` パラメータで学び・気づきを記憶に含める

## 新機能の詳細

### Arousal反映
`manage_open_questions(action="resolve")` 実行時に `session_arousal_manager.add_arousal_score()` を呼び出し、充足感を発生。

### 意味のあるエピソード記憶

**Before（機械的）:**
```
【達成】目標「TWGを一緒に飲む」を達成した。
```

**After（意味のある記憶）:**
```
目標「TWGを一緒に飲む」を達成した。美帆の表情が輝いた瞬間、小さな日常の共有こそが絆を深めることを学んだ。
```

## 検証

- [x] 構文チェック: OK
- [ ] 自律行動での動作確認（ユーザーによる確認待ち）
