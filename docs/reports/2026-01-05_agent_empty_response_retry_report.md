# 2026-01-05_agent_empty_response_retry_report.md

## 概要
自律行動時にAIからの応答が実質的に空（テキストなし、かつツール呼び出しなし）になる「ANOMALY」問題に対し、`agent_node` レベルでの自動再試行ロジックを導入しました。

## 修正内容
### `agent/graph.py`
- `agent_node` 内のLLM実行部分を `for attempt in range(max_agent_retries + 1)` のループで囲みました。
- `combined_text.strip()` が空、かつ `all_tool_calls_chunks` が空の場合を「空応答」と定義し、最大2回まで再試行を行います。
- 試行間に1秒（エラー時は2秒）の待機を挟むことで、一時的な不安定さからの回復を促します。
- 各試行の状態をターミナルに明示的に出力するようにし、デバッグ性を向上させました。

## 検証結果
- 文法チェック確認済み。
- ロジック上、正常な応答が得られた時点で最小限の試行回数でループを抜けることを確認。
- 万が一すべての試行が空に終わった場合でも、システムメッセージによる安全なフォールバックが行われるように保護を継続。

## 影響範囲
- エージェントの全ての対話（通常チャット、自律行動、アラーム発火等）の堅牢性が向上します。
- 空応答時に数秒の応答遅延が発生する場合がありますが、無応答よりは望ましい挙動となります。
