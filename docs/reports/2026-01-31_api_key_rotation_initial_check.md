# APIキーローテーション初回選択時の枯渇チェック追加

**日付:** 2026-01-31  
**ブランチ:** `fix/api-key-rotation-initial-check`  
**ステータス:** ✅ 完了

---

## 問題の概要

複数の無料キーと有料キーを登録しているにも関わらず、API制限エラーが発生する問題。
原因は、初回APIキー選択時に枯渇状態をチェックせず、すでに枯渇したキーをそのまま使用していたこと。

---

## 修正内容

`invoke_nexus_agent_stream`関数に初回キー選択時の枯渇チェックを追加。
指定されたキーが枯渇状態の場合、`get_next_available_gemini_key`で利用可能な代替キーに自動切り替え。

---

## 変更したファイル

- `gemini_api.py` - 初回キー選択時の枯渇チェックロジック追加（15行）

---

## 検証結果

- [x] Python構文チェック（`py_compile`）: PASS
- [x] UI配線検証: 今回の変更に無関連な既存エラーのみ

---

## 残課題

なし
