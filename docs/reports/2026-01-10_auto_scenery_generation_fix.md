# 情景画像自動生成の制御オプション追加レポート

## 概要
情景画像生成システムにおいて、画像が存在しない場合に意図せず自動生成（API利用）が行われてしまう問題を解決するため、ユーザーが明示的に自動生成を許可/不許可できるオプションを追加しました。

## 変更内容
### 1. UIの変更
- **情景描写設定**アコーディオン内に、「🎨 情景画像の自動生成を許可する」チェックボックスを追加しました。
- デフォルト: `True` (ON) - 既存ユーザーの挙動を変えないため。

### 2. ロジックの変更
- `ui_handlers.py` の画像取得ロジック (`_get_updated_scenery_and_image`) にて、以下の条件を判定するようにしました。
  - 画像が見つからない場合:
    - チェックボックスが **ON** なら: 従来通り `handle_generate_or_regenerate_scenery_image` を呼び出して画像を生成。
    - チェックボックスが **OFF** なら: 画像生成をスキップし、テキストのみを更新。「現在の情景画像はありません」という状態を許容する（またはデフォルト画像を表示）。

## 検証結果
- **構文チェック**: `nexus_ark.py`, `ui_handlers.py` のPython構文チェックをパス。
- **設定保存**: `config.json` に `auto_generate_scenery` キーが追加され、ルームごとに設定が保存されることを確認（コードレビューによる）。

## 影響範囲
- 情景システムを使用している全てのルーム。
- 設定はルームごとに個別保存されます。

## 次のステップ
- UIで実際の動作を確認し、必要であればデフォルト値をOFFに変更することも検討してください。
