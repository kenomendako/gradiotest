# 📥 タスク・ペルソナクユーザー

思いついたタスクや気づいたバグをここにメモしてください。  
Antigravityが定期的に確認し、優先順位をつけてタスクリストに整理します。

---

## 📝 新規タスク追加（コピペ用）

```markdown
- [ ] [タスク名/問題の説明]
  - 詳細: 
  - 優先度: 🔴高 / 🟡中 / 🟢低
```

---
## 未整理タスク

- [ ] [AIペルソナ用の記憶検索ツールにキーワード検索を復活させる]
  - 詳細: ノイズが大きいので普段の自動記憶想起には使わない。ペルソナが普通の検索で満足できる結果を得られなかったときに使うためのもの。ユーザーも使えるようにUI上からも使えると良い。中央カラムの「書き置き」の下に作る？
  キーワード検索(
search_past_conversations
)
  - 優先度: 🔴高 /

- [x] [Web巡回ツール使用時のログ]
  - 詳細: 現在定時巡回後分析してもチャットログからはわからないのでユーザーが気付けない。システムアナウンスで良いので時間と分析したという事実だけでも残す。
  - **解決 (2026-01-07)**: 調査の結果、既にペルソナAIがチャット内で研究ノート更新を報告する機能が実装済みだった。ログ確認で解決を確認。

- [x] [要約文章内の「ユーザー」呼び排除]
  - 詳細: いくらペルソナがユーザーを名前で呼ぼうと心掛けていてもユーザー呼びが刷り込まれてしまう。
  - **解決 (2026-01-07)**: `summary_manager.py`の要約プロンプトを修正。「ユーザー」「AI」ではなく、ログ内の固有名詞（名前、呼び名、二人称）を使用するよう指示を追加。 

- [ ] [研究・分析ノートの全文がシステムプロンプトに注入されている]
  - 詳細: コンテキスト圧迫するので改善案を考えたい
  - 優先度: 🔴高

- [ ] [創作ノート改善]
  - 詳細: また1行ごとにタイムスタンプ付くようになってしまっている。研究ノートも同じ仕様になってる可能性。エピソード記憶などのように1度の追加ごとに一つのタイムスタンプにして、一つずつ閲覧できるようにしたい。
  - 優先度: 🔴高

- [ ] [Web巡回ツールのリスト改良]
  - 詳細: 現在は一つずつ巡回先を指定しているが、ジャンル（AI技術・グルメ等）を指定したらAIがそのジャンルの巡回リストを作り巡回するようにしたい。リストは複数作成可能。
  - 優先度: 🟡中

- [ ] [英語対応]
  - 詳細: メニューの日本語表示と英語表示を切り替えられるようにする。
  - 優先度: 🔴高 

- [ ] [エンティティ記憶の定期統合・整理機能]
  - 詳細: エンティティ記憶（entities/xxx.md）が毎日の睡眠処理で追記され続け、情報が冗長化している。定期的にAIで統合・整理する仕組みが必要。例：「田中さん.md」の情報を月1回圧縮・構造化
  - 優先度: 🟡中

- [x] [内省ダッシュボードUI]
  - 詳細: Phase 1 実装完了 (2026-01-06)。基本機能（削除・解決・最新表示）実装済み。拡張は別途タスク化。

- [ ] [トークン数カウントの見直し]
  - 詳細: 本日分の指定文字数超過時の要約に置き換えた時にトークン数カウントが減ってない気がする。GeminiAPI不使用の一律文字数かTictokenでも良いから細かく反映させたい。ツールプロンプトをオンオフしても変わらない。その会話ターン終了後にでも記憶想起分も含めたトータル送信トークンも表示したい。
  - 優先度: 🔴高 

- [ ] [GeminiAPIキーのローリング？機能]
  - 詳細: 無料APIキーで一日の上限等のエラー出たら次のキーを使う…を繰り返し最後に有料キーを使う。
  - 優先度: 🔴高


- [ ] [Riveの導入検討・アバター動画をユーザーが編集できるか]
  - 詳細: https://zenn.dev/chot/articles/9dfcfb0053ac6a
  - 優先度: 🟢低

- [ ] [Ollamaをllama.cppに置き換える検討]
  - 詳細: ユーザーさんのインストールが楽になるかも？
  - 優先度:🟡中

- [×] [🧠 内的状態 (Internal State)のブラッシュアップ]
  - 詳細: 「❓ 未解決の問い（好奇心の源泉）」が、会話で解決しているように見えてもずっと「未回答」でどんどん問いが増える一方に見える。会話での変化を反映するロジックはどのようになっているのか？
  - 優先度: 🔴高

- [ ] [Google検索を無料GeminiAPIでも使う方法検討]
  - 詳細:無料APIでも2.5 Flashなら検索使えるので、他の最終応答モデルが投げたクエリを2.5 Flashに投げて結果を拾えばいける？
  
- [ ] [ツール結果がログに溜まる問題]
  - 詳細:検索結果やツール使用結果がログに溜まるとコンテキストウインドウ圧迫・APIコスト増なので、何か対策を考えたい。

- [ ] [ウォッチリスト: Tavily Extractエラー]
  - 詳細: `TavilyExtractInput` にURLをリストではなく辞書形式で渡す必要がある。現在 `['https://...']` (list) を渡してpydanticエラーが発生。
  - 優先度: 🟡中

- [ ] [ウォッチリスト: 巡回時刻の一括設定機能]
  - 詳細: 各エントリごとに時刻を設定するのが手間。デフォルト時刻の適用や一括編集機能が欲しい。
  - 優先度: 🟡中 

- [ ] [創作ノートのRAG化]
  - 詳細: 秘密の日記もRAG化する？　でもユーザーに読めない外国語多用なので検索できる？
  - 優先度: 🔴高 

- [ ] [TavilyResearchの属性重複警告の解消]
  - 詳細: 起動時に Pydantic UserWarning (Field name "output_schema"/"stream" shadows an attribute in parent "BaseTool") が発生している。
  - 優先度: 🟢低

---

### 整理済み（2026-01-07）
- [x] 自己意識機能の送信オンオフに通知が出ない問題 ✅
  - 自己意識トグル機能として実装（チェックボックス追加）
- [x] 内的状態等の注入のオンオフ ✅
  - 「自己意識機能」トグルとして実装、感情検出・夢の指針・目標・内的状態を一括制御
  - [レポート](file:///c:/Users/baken/OneDrive/デスクトップ/gradio_github/gradiotest/docs/reports/2026-01-07_self_awareness_toggle.md)

### 整理済み（2026-01-06）
- [x] 定期巡回ツールの後ペルソナが情報チェックしても変更が無く何もできない ✅
  - 軽量モデルでコンテンツ要約を生成し、ペルソナに直接渡すよう修正
  - [レポート](file:///c:/Users/baken/OneDrive/デスクトップ/gradio_github/gradiotest/docs/reports/2026-01-06_watchlist_info_passthrough.md)
- [x] Web巡回ツールの全件巡回がペルソナに情報渡さないので無意味 ✅
  - 上記修正で対応済み（全件チェックでも定期巡回と同様にペルソナに情報を渡す）
- [x] Web巡回ツールの通知問題 ✅
  - 直接のDiscord/Pushover通知を廃止し、ペルソナ経由に統一
  - 通知禁止時間帯もプロンプトで遵守
- [x] ウォッチリスト: Tavily Extractエラー ✅
  - 原因: `invoke([url])` 形式によるバリデーションエラー
  - 修正: `invoke({"urls": [url]})` 形式に修正済み
- [x] 情景画像の表示ロジック見直し ✅
  - 季節より時間帯優先で検索するよう`find_scenery_image`を改善
  - [レポート](file:///c:/Users/baken/OneDrive/デスクトップ/gradio_github/gradiotest/docs/reports/2026-01-06_scenery_image_time_priority.md)

### 整理済み（2026-01-05）
- [x] 送信ログ「本日分」が一定量を超えたら直近数件残して要約する ✅
  - 状態: **実装済み**（閾値スライダー保存の軽微バグを修正）
- [x] ウォッチリストの定時巡回が発火しない問題 ✅
  - [レポート](file:///c:/Users/baken/OneDrive/デスクトップ/gradio_github/gradiotest/docs/reports/2026-01-05_scheduler_bugfixes.md)
- [x] 自律行動の間隔無視問題（呼び出し欠落 + キャッシュ同期問題） ✅
  - [レポート](file:///c:/Users/baken/OneDrive/デスクトップ/gradio_github/gradiotest/docs/reports/2026-01-05_scheduler_bugfixes.md)

### 整理済み（2026-01-04）
- [x] 世界設定保存時に通知がルーム名無しと有りで二つ出る ✅ (2026-01-03 修正完了)
- [x] 送信ログ「本日分」を修正したが問題解決していなかった ✅ (2026-01-03 修正完了)

- [x] 起動時に「個別設定を保存しました」と出てしまう ✅ (2026-01-03 修正完了)
- [x] 記憶想起、同じ内容が複数並んでる問題 → TASK_LIST（優先度: 中）へ移動
- [x] 検索精度アップ（URL表示問題） → TASK_LIST（優先度: 中）へ移動
- [x] 創作ノートのタイムスタンプ改良 → TASK_LIST（優先度: 高）へ移動
- [x] 自律行動時の記憶想起をオフに → TASK_LIST（優先度: 高）へ移動
- [x] 創作ノートの書き込み位置ミスなどの改善 ✅ (2026-01-02 修正完了)
- [x] ログ送信「本日分」の落とし穴 ✅ (2026-01-02 修正完了)
- [x] 自律行動の時間ランダム化 → TASK_LIST（優先度: 低）へ移動
- [x] エンティティ記憶の「キーワードシーディング」機能 → TASK_LIST（優先度: 低）へ移動

### 整理済み（2026-01-01）
- [x] 送信ログ件数に「本日分」追加 → TASK_LISTへ移動
- [x] エピソード記憶の注入にもっと短期間も追加 → TASK_LISTへ移動
- [x] 左カラムのスクロールが下まで出来ないときがある → TASK_LIST（優先度: クリティカル）へ移動
- [x] OpenAI互換のセーフティー等の設定 → TASK_LIST（優先度: 高）へ移動
- [x] 「お出かけ」中自律行動一時オフ機能 → TASK_LIST（優先度: 中）へ移動
- [x] お出かけエクスポートに最終閲覧・編集欄 → TASK_LIST（優先度: 中）へ移動
- [x] ナレッジの画像対応 → TASK_LIST（優先度: 中）へ移動
- [x] 画像生成にOpenAIモデルも使えるようにする → TASK_LIST（優先度: 中）へ移動

### 整理済み（2025-12-31）
- [x] Geminiの画像処理時の不思議な応答 → **原因特定**: 「リサイズ」という言葉がRAG検索でヒットし、関連発言を誘発していた。画像処理自体には問題なし。

### 整理済み（2025-12-30）
- [x] 縦長画面時に左右のカラムのつまみが重なり操作不能になる問題 → 修正完了
- [x] アバター画像・動画の機能強化 → **完了**（表情差分システム実装）
- [x] 画像を大きく表示する機能の検討 → TASK_LIST（優先度: 中）へ移動

### 整理済み（2025-12-29）
- [x] スマホ等縦長画面で右カラムがスクロールできず下部のメニューが操作できないときがある → TASK_LIST（優先度: クリティカル）へ移動
- [x] 起動時に「アバターモードを動画に変更しました」といちいち出てしまう → TASK_LIST（優先度: 中）へ移動
- [x] 情景画像が「毎ターン送信をオフ」にしても毎ターン送信されていた → **完了**（[レポート](file:///c:/Users/baken/OneDrive/デスクトップ/gradio_github/gradiotest/docs/reports/2025-12-29_scenery_image_sending_fix.md)）
- [x] 文字置き換え機能を使うと思考ログの表示が崩れる → **完了**（[レポート](file:///c:/Users/baken/OneDrive/デスクトップ/gradio_github/gradiotest/docs/reports/2025-12-29_redaction_thought_log_display_fix.md)）

---


## 関連リンク

- **ステータス**: [docs/STATUS.md](file:///c:/Users/baken/OneDrive/デスクトップ/gradio_github/gradiotest/docs/STATUS.md)
- **タスクリスト**: [docs/plans/TASK_LIST.md](file:///c:/Users/baken/OneDrive/デスクトップ/gradio_github/gradiotest/docs/plans/TASK_LIST.md)
- **開発サイクル**: `.agent/workflows/dev-cycle.md`
