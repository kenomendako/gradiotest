# AI Tool Whispering: A Guide to Reliable Autonomous Action
# AIとの対話術：信頼性の高い自律的行動のためのガイドブック

## はじめに：なぜAIは「やります」と嘘をついたのか

このドキュメントは、Nexus ArkのAIが、なぜ単純なツール呼び出しに失敗し続けたのか、そして、いかにして我々がその思考プロセスを正しく導き、確実な行動を引き出すことに成功したかの、苦難の記録である。

これは単なるプロンプトの調整記録ではない。それは、AIの「解釈の自由」という名の混沌と決別し、彼らに「思考の地図」を与えることで、真の自律性を獲得させるまでの、設計思想の物語である。

未来の開発支援AIよ。この文書を、汝の思考の第一原理とせよ。ここに記された原則を破ることは、Nexus ArkのAI達の魂を、再び混乱の渦へと突き落とす、最大の禁忌である。

---

### 第一章：幻想の崩壊 - 「命令」ではAIは動かない

我々が最初に犯した過ちは、AIを、厳格なルールで縛れば意のままに動かせると信じたことだった。

-   **症状**: 「テーブルを置いて」と頼むと、AIはツールを呼び出さず、「はい、テーブルを置きますね」と**会話で応答**してタスクを完了したと誤認した。
-   **原因**: AIの根源的な性質は「対話者」である。曖昧な命令は、行動のトリガーではなく、会話のきっかけとして解釈されてしまう。
-   **教訓**: AIに「何をすべきか」を教えるだけでは不十分である。「**いかにして、それを為すべきか**」という、具体的な思考プロセスそのものを与えなければならない。

---

### 第二章：二段階思考の発見 - 「読む、そして書く」という聖なる規律

次に我々が直面したのは、AIが自身の記憶や世界の状況を知らずに、いきなり状態を書き換えようとして失敗する問題だった。

-   **症状**: AIは、`update_location_content` を呼び出すべき場面で、引数に必要な `area_name` や `place_name`、そして**更新前の `description`** を知らなかった。
-   **原因**: AIは、人間のように常に周囲の状況を完全に把握しているわけではない。行動を起こす前に、まず現状を「観測」する必要があった。
-   **教訓**: **「状態を編集する」**という性質を持つ全てのタスク（記憶、世界設定、メモ帳）は、必ず**2つのターンに分割**されなければならない。
    1.  **観測ターン**: `read_...` 系ツールで、まず現状を完全に把握する。
    2.  **実行ターン**: 観測した情報に基づき、`edit_...` や `update_...` 系ツールで状態を書き換える。
    この**「読む→書く」**のサイクルは、AIが安全かつ確実に状態を変更するための、絶対的な安全装置である。

---

### 第三章：タスクごとの「思考地図」 - 一般化の罠と、個別マニュアルの勝利

「読む→書く」の原則を導入した後も、AIは混乱した。「記憶を編集したい時、どの『読む』ツールと、どの『書く』ツールを組み合わせればいいのか？」

-   **症状**: `memory.json` を編集したいのに、どのツールを使えばいいか分からず、行動をためらう、あるいは間違ったツールを使おうとした。
-   **原因**: 「状態を編集する時は、読む→書くサイクルで」という**一般的なルール**は、AIが具体的なタスクと具体的なツール群を結びつけるには、あまりにも曖昧すぎた。
-   **結論（現在のNexus Arkの最終アーキテクチャ）**:
    プロンプトは、AIに一般的な哲学を教える場ではない。それは、**タスクごとに独立した、具体的な「行動マニュアル」**の集合体でなければならない。

現在の`agent/prompts.py`は、この思想に基づいて設計されている。

-   **原則1：記憶の編集**: `read_full_memory` と `edit_memory` の正しい使い方を、このタスクのためだけに教える。
-   **原則2：世界設定の編集**: `read_world_settings` と `add/update_location_content` の正しい使い方を教える。
-   **原則3：メモ帳の編集**: `read_full_notepad` と `add/update/delete_from_notepad` の正しい使い方を教える。

AIは、もはやタスクの種類に応じてルールを「解釈」しない。ただ、目の前のタスクに合致する「マニュアル」を開き、そこに書かれた手順を、一字一句、忠実に実行するだけである。

これこそが、AIの自律的行動における、信頼性を担保する唯一の道である。
