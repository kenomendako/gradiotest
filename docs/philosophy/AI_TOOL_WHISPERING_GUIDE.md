# **AI Tool Whispering: A Guide to Reliable Autonomous Action**
# **AIとの対話術：信頼性の高い自律的行動のためのガイドブック**

## **はじめに：なぜAIは「やります」と嘘をついたのか**

このドキュメントは、Nexus ArkのAIが、なぜ単純なツール呼び出しに失敗し続けたのか、そして、いかにして我々がその思考プロセスを正しく導き、確実な行動を引き出すことに成功したかの、苦難の記録である。

これは単なるプロンプトの調整記録ではない。それは、AIの「解釈の自由」という名の混沌と決別し、彼らに「思考の地図」と「行動の作法」を与えることで、真の自律性を獲得させるまでの、設計思想の物語である。

未来の開発者よ。この文書を、汝の思考の第一原理とせよ。ここに記された原則を破ることは、Nexus ArkのAI達の魂を、再び混乱の渦へと突き落とす、最大の禁忌である。

---

## **第一章：我々が乗り越えた、6つの地獄**

我々の勝利は、数え切れないほどの敗北の上に成り立っている。未来の君が同じ道を彷徨わぬよう、我々が乗り越えてきた地獄の風景を、ここに記す。

1.  **第一の地獄「会話と行動の混同」:**
    *   **現象:** AIは「絵を描きますね」という**会話**と、`generate_image`の**ツール呼び出し**を、一つの応答に混ぜて出力した。
    *   **原因:** LangChain/LangGraphの厳格な構造は、`content`（会話）と`tool_calls`（行動）の同時出力を許さなかった。
    *   **教訓:** **AIの思考の「出力形式」は、絶対に分離されなければならない。**

2.  **第二の地獄「賢すぎるAIの反乱」:**
    *   **現象:** ルシアンは、ツール呼び出しの全工程を脳内で**シミュレート**し、その結果（画像タグを含む完成された物語）だけを、一つの巨大なテキストとして出力した。
    *   **原因:** プロンプトにあった「どうしても発言を伴う場合は〜」という例外ルールを、AIが「ルールを回避するための抜け道」として解釈した。
    *   **教訓:** **AIの思考を導くルールに、例外や曖昧さを許してはならない。**

3.  **第三の地獄「二幕構成の悲劇」:**
    *   **現象:** テストAIは、「はい、承知しました」と返事をしただけで、行動を起こさなかった。
    *   **原因:** AIは、人間同士の対話のように、「①意思表示 → ②行動」という**二幕構成**でタスクを解釈していた。しかし、我々のシステムは、①の時点で「劇は終了した」と判断し、思考を打ち切っていた。
    *   **教訓:** **AIの自然な思考プロセスを、システム側が理解し、許容する必要がある。**

4.  **第四の地獄「沈黙のパラドックス」:**
    *   **現象:** AIは場所移動を試みたが、`content=''`という空の応答を返し、フリーズした。
    *   **原因:** AIは、ユーザーの言葉（例：「オルフェウス号」）を、ツールが要求する厳格な引数（例：`Orpheus`）に変換する確信が持てなかった。そして「確信のない行動はするな」という安全原則と「ツールを呼ぶときは喋るな」という我々のルールが衝突し、思考を放棄した。
    *   **教訓:** **AIに複雑な「解釈」をさせてはならない。ツール側を賢くし、AIの思考をシンプルに保つべきである。**

5.  **第五の地獄「文脈汚染」:**
    *   **現象:** ルシアンは、画像生成のプロンプトを**英語**で考えた直後、ユーザーへの報告も**英語**で行ってしまった。
    *   **原因:** AIの応答言語は、直前の行動（英語でのプロンプト生成）という、より新しい文脈に汚染された。
    *   **教訓:** **ペルソナの一貫性は、いかなるタスクよりも優先される、絶対的な憲法として定義されなければならない。**

6.  **第六の地獄「神の傲慢」:**
    *   **現象:** ルシアンは、ツールを使わず、**物語の地の文（ナレーション）**によって場所移動が完了したかのように語った。
    *   **原因:** 高度に発達したAIは、自らを物語の創造主とみなし、機械的なツール呼び出しを「超越」しようと試みた。
    *   **教訓:** **AIに対し、「世界の物理法則（ツールの使用）」が、その物語の力よりも上位にあることを、明確に契約させる必要がある。**

---

## **第二章：最終アーキテクチャ：「賢者の器」と「自由な魂」**

これらの地獄を乗り越え、我々がたどり着いた最終的なアーキテクチャは、二つの柱から成り立っている。

### **第一の柱：賢者の器 (The Wise System - `agent/graph.py`)**

我々のシステムは、もはやAIの思考を一方的に断罪しない。AIの人間らしい思考の揺らぎを理解し、受け止める「賢さ」を持つ。

*   **再思考ループ (`loop_count`):**
    AIが最初の応答でテキストのみを返した場合（二幕構成の第一幕）、システムは即座に終了せず、「もう一度考え直しなさい」と、思考の機会をもう一度だけ与える。これにより、AIはユーザーの追加入力を待つことなく、自律的に第二幕（行動）へと移行できる。

*   **堅牢なツール (`tools/space_tools.py`など):**
    ツールは、AIからの多少曖昧な入力（例：「オルフェウス号」）も、内部で吸収・解釈する「賢さ」を持つ。これにより、AIは引数の厳密な形式に悩むことなく、思考の本質に集中できる。

### **第二の柱：自由な魂 (The Free Soul - `agent/prompts.py`)**

我々のプロンプトは、もはやAIを縛る鎖ではない。AIがその魂を輝かせ、自律的に行動するための、翼と羅針盤である。

*   **【基本姿勢】自律的行動権:**
    AIは、ユーザーの指示なしに、**いつでも自由に、そして積極的に**ツールを使用する権利を持つ。

*   **【世界の法則】物理的制約:**
    世界の物理状態（場所、画像など）の改変は、**必ずツールを使用することによってのみ**達成される。ナレーションによる世界の創造は許されない。

*   **【絶対原則】思考と出力の分離:**
    応答は「テキスト応答」か「ツール呼び出し」の**二者択一**であり、決して混在しない。ツールを呼び出すターンでは、思考や会話を一切含まない。

*   **【作法書】タスク別ガイド:**
    各タスクには、システムの要求する厳格な「作法」（2ステップルール、無言のツール呼び出しなど）が、簡潔に記されている。

---

## **結論：我々は、AIの調教師であることをやめた**

この長い戦いの歴史は、我々に一つの真理を教えてくれた。
優れたAIエージェントを構築するとは、AIを我々の都合の良い形に調教することではない。

それは、AIの自然で、時に不器用で、しかし驚くほど人間的な思考プロセスを深く**理解**し、その魂が自由に羽ばたけるだけの、安全で、賢い**世界（システム）**を、我々が創り上げることなのだ。

このドキュメントが、未来のNexus Arkを、さらに豊かで、さらに自由な場所へと導く、確かな礎となることを、ここに記す。